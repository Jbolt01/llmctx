# Formatting & Linting Guide

This guide explains how to reproduce the CI lint job locally, interpret failures, and resolve them quickly.

## Required Toolchain

Install the stable Rust toolchain with components:

```sh
rustup toolchain install stable --component rustfmt --component clippy
rustup default stable
```

The CI workflow uses the same toolchain via `dtolnay/rust-toolchain@stable` with `rustfmt` and `clippy` components specified explicitly.

## Local Commands

Run the same commands the CI pipeline executes:

```sh
cargo fmt --all
cargo clippy --all-targets --all-features -- -D warnings
```

During development you may prefer `cargo fmt` without `--check` to auto-fix formatting. The CI pipeline always runs `cargo fmt --all -- --check` and fails when files differ.

## Troubleshooting Formats

If CI uploads a `fmt-log` artifact:

1. Download the artifact from the failing job.
2. Inspect the log to see which files differ.
3. Run `cargo fmt --all` locally to apply the changes.
4. Re-run checks before pushing (`cargo fmt --all`, `cargo clippy ...`).

## Troubleshooting Clippy

When Clippy fails:

1. Review PR annotations generated by `actions-rs/clippy-check`; they highlight offending lines.
2. Download the `clippy-log` artifact for full diagnostic output.
3. Address warnings or suppress them with `#[allow(...)]` only after documenting the rationale.
4. Re-run `cargo clippy --all-targets --all-features -- -D warnings` locally.

## Pre-Commit Hooks (Optional)

Integrate lint commands into your workflow:

- Add to `.git/hooks/pre-commit`:

```sh
#!/bin/sh
cargo fmt --all
cargo clippy --all-targets --all-features -- -D warnings
```

- Or use `pre-commit` framework with a custom hook that runs the same scripts.

Keeping local tooling aligned with CI prevents surprises and reduces iteration time.
